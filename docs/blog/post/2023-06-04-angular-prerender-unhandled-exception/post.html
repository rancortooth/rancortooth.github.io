<hr />
<p>date: "2023-06-04"
title: Angular Unhandled Exception Could Not Find Main Bundle
image: angular_fire.png
categories: Angular</p>
<h2 id="tagsangulartroubleshooting">tags: angular, troubleshooting</h2>
<h5 id="imagegeneratedwithstable_diffusionopenvino">(image generated with stable_diffusion.openvino)</h5>
<h1 id="anunhandledexceptionoccurredcouldnotfindthemainbundlemainjs">An unhandled exception occurred: Could not find the main bundle: main.js</h1>
<p>While working on this website I've encountered this error a few times while trying to prerender while using the @nguniversal/express-engine library</p>
<pre class="bash language-bash"><code class="hljs bash language-bash"><span class="hljs-comment"># i.e. When executing a command such as this</span>
ng run MyWebsite:prerender
</code></pre>
<p>This unhelpful error typically indicates you have a subtle build error which prerendering is encoutering but not reporting on. In most cases, the website will appear to run fine while debugging yet this error still occurs.</p>
<h1 id="somestepstotaketogetaroundthis">Some steps to take to get around this</h1>
<h2 id="trycleaningrebuildingyourwayoutoftrouble">Try cleaning/rebuilding your way out of trouble</h2>
<p>If you've made module changes or other significant changes, you may need to wipe out everything and rebuild from scratch. If any of these commands fails along the way, resolve the issue as it may be related to your prerendering woes.</p>
<pre class="bash language-bash"><code class="hljs bash language-bash"><span class="hljs-comment"># Get rid of any half-baked prerendered files</span>
<span class="hljs-built_in">rm</span> -rf dist/MyWebsite

<span class="hljs-comment"># Clear Angular&#x27;s cache</span>
<span class="hljs-built_in">rm</span> -rf .angular/cache

<span class="hljs-comment"># Get rid of the package lock file</span>
<span class="hljs-built_in">rm</span> package-lock.json

<span class="hljs-comment"># Get rid of the modules directory</span>
<span class="hljs-built_in">rm</span> -rf node_modules/

<span class="hljs-comment"># Get rid of server.ts as it&#x27;s generated by express-engine</span>
<span class="hljs-built_in">rm</span> server.ts
</code></pre>
<p>Ok! You've cleaned up. Time to rebuild.</p>
<pre class="bash language-bash"><code class="hljs bash language-bash"><span class="hljs-comment"># Install your modules</span>
npm install

<span class="hljs-comment"># Explicitly add back the express-engine and let it re-generate its stuff</span>
ng add @nguniversal/express-engine

<span class="hljs-comment"># Try prerendering again</span>
ng run MyWebsite:prerender
</code></pre>
<h2 id="dontignorewarnings">Don't ignore warnings</h2>
<p>If your project runs during development even though it has a stack of warnings - don't ignore them! Resolve them.</p>
<h2 id="dontrunwithdirtyhtml">Don't run with dirty HTML</h2>
<p>By "dirty" I mean if you're getting warnings about parts of your HTML being sanitized during the build then address these areas. For example, if content is dynamically placed into a table which may have dangerous content - or in my case, if  you're using ngx-markdown - address these issues.</p>
<h2 id="backtrackabitwhatdidyouchange">Backtrack a bit - what did you change?</h2>
<p>If you were prerendering successfully before some recent changes, then backtrack. Do things such as commenting out those new routes you added in your app's routing module and try pre-rendering without them. The goal here is to isolate the change causing the problem and then study it more closely.</p>